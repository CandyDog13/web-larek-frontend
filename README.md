# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Товар

```
export interface IProduct {
    title: string;
    description: string;
    price: number;
    image: string;
    category: string;
    _id: string;
}
```

Покупатель

```
export interface IUser {
    payment: string;
    address: string;
    email: string;
    number: string;
}

```

Отправка заказа

```
export interface IOrder {
    _id: string;
    total: number;
}
```

Модель для хранения листа товаров

```
export interface IProductList {
    products: IProduct[];
    total: number;
    preview: string | null;
    
}
```
Описание корзины

```
export interface IBasketModel {
    totalOrder:TOrderTotal;
    items: Map<string, number>;
```

Данные товара, используемые на главном экране

```
export type TProductMainPage = Pick<IProduct, 'title' | 'price' | 'image' | 'category'>
```

Данные финальной суммы заказа

```
export type TOrderTotal = Pick<IOrder, 'total'>
```

Данные, необходимые для формирования корзины

```
export type TBasket = Pick<IProduct, 'title'| 'price'> & TOrderTotal>
```

Данные покупателя в форме заполнения адреса и способа оплаты

```
export type TUserPayAddress = Pick<IUser, 'address' | 'payment'>
```

Данные покупателя в форме заполнения электронной почты и телефона

```
export type TUserEmailTelephone = Pick<IUser, 'email' | 'number'>
```

## Архитектура приложения

Код приложения разделен на стои согласно парадигме MVP(Model, View, Presenter):
- слой представления View отвечает за отображение данных на странице;
- слой данных Model отвечает за хранение и изменение данных;
- слой презентера отвечает за связь представления и данных между собой;

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.  
Методы:
- `get` - выполняет GET запрос на переданный в параметрах endpoint и возвращает promise с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на endpoint переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter 

Брокер событий позволяет отправить события и подпиываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации события.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие;
- `emit`- инициализация события;
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие;

### Слой данных

#### Класс ProductList

Класс отвечает за хранение товаров на главной странице и просмотр отдельных товаров  
Конструктор класса принимает инстант брокера событий  
В полях класса хранятся следующие данные:
- `_products: IProduct[];` - массив объектов товаров;
- `total: number;` - общее количество товаров;
- `preview: string | null;` - id товара, который необходимо открыть в модальном окне
- `events: IEvents` - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Также класс имеет метод для работы с данными.  
`getProduct(productId:string): IProduct;` - возвращает товар по его id.\
а также сеттеры и геттеры для сохранения и получения данных полей

#### Класс BasketModel

Класс отвечает за хранение данных корзины товаров и работу с товарами в корзине\
Конструктор класса принимает инстанты брокера событий\
В полях хранятся следующие данные:
- `_totalOrder:TOrderTotal;` - значение суммы заказов
- `_items: Map<string, number>;` - список заказов
- `events: IEvents` - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Методы взаимодействия: 
- `addProduct(id:string):void;` - добавление нового товара в список заказов
- `removeProduct(id:string):void;` - удаление товара из списка заказов
- `clear():void;` - очистка списка товаров (очистка корзины товаров)

#### Класс UserData

Класс отвечает за хранение данных о покупателе и позволяет работать с этими данными\
Конструктор класса принимает инстант брокера событий
В полях класса хранятся данные:
- `payment: string;` - параметр вида оплаты
- `address: string;` - адрес доставки
- `email: string;` - электронная почта для заказа
- `number: string;` -  номер телефона покупателя
- `events: IEvents` - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Также в классе присутстуют методы для работы с данными:

- `setUserPayAddress(userData:TUserPayAddress):void;` - метод позволяет сохранить данные об адресе и методе оплаты
- `setUserEmailPhone(userData:TUserEmailTelephone):void;` - метод позволяет сохранить данные о номере телефона и адресе электронной почты покупателя
- `checkUserValidation(data:Record<keyof IUser, string>):boolean;` - проверка на валидность введенных значений

### Классы представления
Все классы представления отвечают за отображение внутри контейнета (DOM - элемент) передаваемых в них данных
